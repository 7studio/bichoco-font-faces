
// The full path where font files are stored
// The path must not contain the trailing slash
// Ex: /wp-content/themes/bichoco/assets/datas/fonts
// @var {string} $FONTS_URI
$FONTS_URI: '' !default;

// List of font extensions used to construct the @font-face rule
// The list can be overloaded by an other list or a string in each mixin inclusion
// @var {list|string} $FONT_FACES_EXTENSIONS
$FONT_FACES_EXTENSIONS: ('.eot', '.woff', '.ttf') !default;



// Find whether the given variable is a recognised shortened variation
// @function is-font-face-shortened-variation
// @arg {string} $arg The shortened variation being evaluated
// @return boolean
@function is-font-face-shortened-variation($arg)
{
  $values: ('i1', 'i2', 'i3', 'i4', 'i5', 'i6', 'i7', 'i8', 'i9', 'n1', 'n2', 'n3', 'n4', 'n5', 'n6', 'n7', 'n8', 'n9');

  $index: index($values, $arg);

  @return if(($index != false), true, false);
}



// Find whether the given variable is associated to an extension defined by the specification
// The variable (file extension) must contain dot at the beginning
// http://www.w3.org/TR/css3-fonts/#fontformats
// @function is-font-face-extension
// @arg {string} $arg The file extension being evaluated
// @return boolean
@function is-font-face-extension($arg)
{
  $extensions: ('.eot', '.woff', '.ttf', '.otf');

  $index: index($extensions, $arg);

  @return if(($index != false), true, false);
}



// Explode shortened variation and return font-style and font-weight descriptors
// https://gist.github.com/4135145
// @function explode-font-face-shortened-variation
// @arg {string} $variation The shortened variation being exploded
// @return list
@function explode-font-face-shortened-variation($variation)
{
  $abbreviations: ('i1', 'i2', 'i3', 'i4', 'i5', 'i6', 'i7', 'i8', 'i9', 'n1', 'n2', 'n3', 'n4', 'n5', 'n6', 'n7', 'n8', 'n9');
  $variations: ((italic, 100), (italic, 200), (italic, 300), (italic, 400), (italic, 500), (italic, 600), (italic, 700), (italic, 800), (italic, 900), (normal, 100), (normal, 200), (normal, 300), (normal, 400), (normal, 500), (normal, 600), (normal, 700), (normal, 800), (normal, 900));

  $index: index($abbreviations, $variation);

  @return nth($variations, $index);
}



// Built one external references item of src descriptor
// http://www.w3.org/TR/css3-fonts/#descdef-src
// @function bluid-font-face-src
// @arg {string} $file-uri The full path with filename of the font file
// @arg {string} $extension The file extension (must contain dot at the beginning)
// @return string
@function bluid-font-face-src(
   $file-uri
  ,$extension
)
{
  $format: '';

  @if $extension == '.eot'
  {
    $extension: '#{$extension}?#iefix';
    $format: 'embedded-opentype';
  }
  @else if $extension == '.ttf'
  {
    $format: 'truetype';
  }
  @else if $extension == '.otf'
  {
    $format: 'opentype';
  }
  @else if $extension == '.woff'
  {
    $format: 'woff';
  }

  @return join(
     url('#{$file-uri}#{$extension}')
    ,format($format)
    ,space
  );
}



// Built the font file name from its weight and style of defined convention
// Convention: [ [ weight || style ] | weight-style ] && .[ eot | woff | ttf | otf | svg | svgz ]
// Exs: regular.eot, bold-italic.woff, italic.otf, bold.svg
// https://gist.github.com/4135145
// @function bluid-font-file-name
// @arg {string} $variation The shortened variation
// @return string
@function bluid-font-file-name($variation)
{
  $keywords: ('i1', 'i2', 'i3', 'i4', 'i5', 'i6', 'i7', 'i8', 'i9', 'n1', 'n2', 'n3', 'n4', 'n5', 'n6', 'n7', 'n8', 'n9');
  $names: ('thin-italic', 'extralight-italic', 'light-italic', 'italic', 'medium-italic', 'semibold-italic', 'bold-italic', 'extrabold-italic', 'black-italic', 'thin', 'extralight', 'light', 'regular', 'medium', 'semibold', 'bold', 'extrabold', 'black');

  $index: index($keywords, $variation);

  @return nth($names, $index);
}



// Built @font-face rule
// @mixin: font-face
// @arg {string} $family-name The font-family descriptor value
// @arg {string} $folder-name Directory name where font family files are stored
// @arg {string} $variation Value of the shortened variation
// @arg {list|string} $extensions The list of font extensions
// @warn When one of font property descriptors (font-style, font-weight) or the font extension is invalid
@mixin font-face(
   $family-name
  ,$folder-name: null
  ,$variation: 'n4'
  ,$extensions: $FONT_FACES_EXTENSIONS
)
{
  $file-name: '';
  $file-uri: '';
  $src: ();
  $style: normal;
  $weight: 400;


  @if is-font-face-shortened-variation($variation) == false
  {
    @warn "#{$variation} : is not a valid value for a shortened variation.";
  }

  // folder-name
  @if $folder-name == null
  {
    $folder-name: $family-name;
  }

  // extensions
  @if type-of($extensions) == string
  {
    $extensions: append((), $extensions);
  }

  $file-name: bluid-font-file-name($variation);
  $file-uri: '#{$FONTS_URI}/#{$folder-name}/#{$file-name}';

  $font-descriptors: explode-font-face-shortened-variation($variation);
  $style: nth($font-descriptors, 1);
  $weight: nth($font-descriptors, 2);

  @font-face {
    font-family: quote($family-name);

    // IE9 Compat Modes
    @if not not index($extensions, '.eot')
    {
      src: url('#{$file-uri}.eot');
    }

    @if type-of($extensions) == list
    {
      @each $extension in $extensions
      {
        // extensions
        @if not is-font-face-extension($extension)
        {
          @warn "#{$extension} : is not a file extension associated to a font format defined by the specification.";
        }

        $src: append(
           $src
          ,bluid-font-face-src($file-uri, $extension)
          ,comma
        );
      }
    }
    @else
    {
      @warn "It's necessary to define at least one extension for @font-face rule.";
    }

    src: $src;

    font-style: unquote($style);
    font-weight: $weight;
  }
}

// Built several @font-face rule simultaneously
// @mixin: font-faces
// @arg {string} $family-name The font-family descriptor value
// @arg {string} $folder-name Directory name where font family files are stored
// @arg {list} $variations List of values or combinations identifying a variation of the font. Ex: (n4, i4, n7, i7)
// @arg {list|string} $extensions The list of font extensions
// @warns When you put just one variation or nothing
@mixin font-faces(
   $family-name
  ,$folder-name: null
  ,$variations: ('n4', 'i4', 'n7', 'i7')
  ,$extensions: $FONT_FACES_EXTENSIONS
)
{
   @if type-of($variations) == list
  {
    @each $variation in $variations
    {
      @include font-face($family-name, $folder-name, $variation, $extensions);
    }
  }
  @else if type-of($variations) == string
  {
    @warn "Use font-face mixin just for one style !";
  }
  @else
  {
    @warn "Fail !";
  }
}